generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuarios {
  id             Int      @id @default(autoincrement())
  nome           String
  sobrenome      String
  dataNascimento DateTime
  cpf            String?  @unique

  endereco    String?
  cep         String?
  rua         String?
  numero      String?
  complemento String?
  bairro      String?
  cidade      String?
  estado      String?

  email    String @unique
  ddd      String?
  telefone String
  senha    String
  posicao  String @default("USER")

  isEmailVerified   Boolean   @default(false)
  emailVerifyToken  String?
  emailTokenExpires DateTime?

  resetToken        String?
  resetTokenExpires DateTime?

  pedidos Pedidos[] // Um usuário pode ter vários pedidos
}

model produtos {
  id               String          @id @default(cuid())
  nome             String
  descricao        String?         @db.Text // Permite texto longo com formatação
  preco            Float
  peso             Float?          // Peso em kg
  altura           Float?          // Altura em cm
  largura          Float?          // Largura em cm
  comprimento      Float?          // Comprimento em cm
  quantidade       Int
  cor              String          // Mudou de enum para String
  tamanho          Tamanho        
  categoria        Categoria
  ocasiao          Ocasiao?
  precoPromocional Float?
  ativo            Boolean         @default(true)
  imagens          ProdutoImagem[]
  emDestaque       Boolean         @default(false)
  criadoEm         DateTime        @default(now())

  itensPedido ItemPedido[]
}

model ProdutoImagem {
  id      String @id @default(uuid())
  urls    Json // large, medium, thumbnail
  posicao Int    @default(0)

  produtoId String
  produto   produtos @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@map("produto_imagens")
}

model Pedidos {
  id             String       @id @default(uuid())
  criadoEm       DateTime     @default(now())
  status         StatusPedido @default(CARRINHO)
  usuarioId      Int
  pagamento      Pagamentos?
  dataFinalizado DateTime?
  codigoRastreio String?
  empresaFrete   String? // CORREIOS, JADLOG, ETC.
  QrCode         String? // QR Code para pagamento, se aplicável

  enderecoEntrega String?
  cep             String?
  rua             String?
  numero          String?
  complemento     String?
  bairro          String?
  cidade          String?
  estado          String?

  // Dados do frete para Melhor Envio
  pesoFrete      Float?  // Peso do pacote em kg
  alturaFrete    Float?  // Altura em cm
  larguraFrete   Float?  // Largura em cm
  comprimentoFrete Float? // Comprimento em cm
  chaveNotaFiscal String? // Chave da nota fiscal
  melhorEnvioId   String? // ID da etiqueta no Melhor Envio
  statusEtiqueta  String? // Status da etiqueta (AGUARDANDO_DADOS, AGUARDANDO_PAGAMENTO, etc)

  usuario Usuarios     @relation(fields: [usuarioId], references: [id])
  itens   ItemPedido[] // Um pedido tem vários itens
}

model ItemPedido {
  id            Int    @id @default(autoincrement())
  pedidoId      String
  produtoId     String
  quantidade    Int
  precoUnitario Float?

  pedido  Pedidos  @relation(fields: [pedidoId], references: [id])
  produto produtos @relation(fields: [produtoId], references: [id], onDelete: Cascade)
}

model ConteudoSobreNos {
  id        String @id @default(uuid())
  
  // Identificador da seção, ex: "identidade" ou "valores"
  // Usaremos isso para saber qual conteúdo buscar para qual seção.
  secao     String @unique

  titulo    String
  texto     String @db.Text // @db.Text permite textos mais longos
  
  // O objeto JSON que já usamos para guardar as URLs das imagens no S3
  urlsImagem Json

  atualizadoEm DateTime @updatedAt
}

model Pagamentos {
  id       String          @id @default(uuid())
  pedidoId String          @unique
  status   StatusPagamento
  metodo   MetodoPagamento

  valorProdutos         Float // Subtotal de todos os itens (soma de ItemPedido.precoUnitario * quantidade)
  valorFrete            Float
  valorTaxaCartao       Float? // Taxa base cobrada pelo gateway (ex: 1.99%)
  valorTaxaParcelamento Float? // Custo adicional das parcelas
  descontos             Float? // Valor de cupons, se houver
  valorTotal            Float // A soma final que o cliente pagou (valorProdutos + frete + taxas - descontos)

  pixQrCodeBase64 String? @db.Text // Armazena a imagem do QR Code
  pixQrCode       String? @db.Text // Armazena o código "copia e cola"

  parcelas             Int?
  gatewayTransactionId String? // ID da transação no Mercado Pago, para reconciliação
  criadoEm             DateTime @default(now())

  pedido Pedidos @relation(fields: [pedidoId], references: [id])
}

model CarrosselImagem {
  id      String  @id @default(uuid())
  urls    Json
  posicao Int     @default(0)
  ativo   Boolean @default(true)
  link    String?

  createdAt DateTime @default(now())

  @@map("carrossel_imagens")
}

enum StatusPedido {
  CARRINHO
  AGUARDANDO_PAGAMENTO
  PAGO
  ENVIADO
  ENTREGUE
  CANCELADO
  EM_PREPARACAO
  EM_TRANSPORTE
  FINALIZADO
  EM_DEVOLUCAO
  DEVOLVIDO
  REEMBOLSADO
}

enum StatusPagamento {
  PENDENTE
  APROVADO
  FALHOU
  ESTORNADO
  CANCELADO
  REEMBOLSADO
}

enum MetodoPagamento {
  CARTAO
  BOLETO
  PIX
}

enum Categoria {
  SAIA
  SHORT
  CALÇA
  BLUSA
  CAMISA
  CONJUNTOS
  VESTIDO
  CALCADO
  ACESSORIOS
  OUTROS
}

enum Tamanho {
  PP
  P
  M
  G
  GG
}

enum Ocasiao {
  CASAMENTO
  BATIZADO
  MADRINHAS
  FORMATURA
  OCASIOES_ESPECIAIS
  CASUAL
  FESTAS
  OUTROS
}
